version: '3.8'

services:
  email-automation:
    env_file:
      - .env
    image: arbi-email-automation:latest
    container_name: arbi-email-automation
    ports:
      - "3400:5000"
    volumes:
      - /root/deployments/email-automation/data:/data
      - /root/.openclaw/workspace/gmail_credentials.json:/credentials/gmail_credentials.json:ro
      - /root/.openclaw/workspace/gmail_token.json:/credentials/gmail_token.json:ro
    environment:
      - GMAIL_CREDENTIALS=/credentials/gmail_credentials.json
      - GMAIL_TOKEN=/credentials/gmail_token.json
      - DISCORD_WEBHOOK=${DISCORD_WEBHOOK}
      - CHECK_INTERVAL=300
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5000/health')"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
